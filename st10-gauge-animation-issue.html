<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ST-10 반원형 게이지 애니메이션 이슈 - Claude/Gemini 솔루션 요청용</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; max-width: 900px; margin: 40px auto; padding: 20px; line-height: 1.6; }
        h1 { color: #333; border-bottom: 2px solid #614CC7; padding-bottom: 10px; }
        h2 { color: #614CC7; margin-top: 32px; }
        table { border-collapse: collapse; width: 100%; margin: 16px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: #f5f5f5; }
        .code { background: #f8f8f8; padding: 16px; border-radius: 8px; font-family: 'Consolas', 'Monaco', monospace; overflow-x: auto; margin: 16px 0; white-space: pre-wrap; font-size: 13px; }
        .copy-btn { background: #614CC7; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 14px; margin-top: 20px; }
        .copy-btn:hover { background: #5139a8; }
        a { color: #614CC7; }
        .issue-box { background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 16px; margin: 16px 0; }
        .issue-box h3 { margin-top: 0; color: #856404; }
    </style>
</head>
<body>
    <h1>ST-10 반원형 게이지 - 애니메이션 미작동 이슈</h1>
    <p>Android Compose(Kotlin)로 구현한 Figma ST-10 반원형 게이지에서 <strong>애니메이션이 재생되지 않는</strong> 문제가 있습니다. Claude / Gemini에게 솔루션을 요청하기 위한 문서입니다.</p>

    <hr>

    <h2>1. Figma 디자인 정보</h2>
    <p><strong>URL:</strong> <a href="https://www.figma.com/design/jTxTaPrc0c2cyGeSRknNEN/cole?node-id=317-3002" target="_blank">https://www.figma.com/design/jTxTaPrc0c2cyGeSRknNEN/cole?node-id=317-3002</a></p>
    <p><strong>화면명:</strong> ST-10 자가테스트 결과 화면</p>
    <p><strong>게이지 스펙:</strong> 250~500 스케일, 반원형 아크, 5색 그라데이션(초록→파랑→노랑→주황/빨강), 중앙 점수, 삼각형 인디케이터</p>

    <h2>2. 현재 구현 현황 (완료된 부분)</h2>
    <ul>
        <li>반원형 아크 Canvas 그리기 (트랙 + fill)</li>
        <li>250~500 스케일, 하단 라벨 (250, 350, 500)</li>
        <li>5색 그라데이션 아크 (Brush.sweepGradient)</li>
        <li>삼각형 인디케이터 (Path + rotate)</li>
        <li>중앙 점수 표시</li>
        <li><code>animateFloatAsState</code>로 progress 애니메이션 시도 (600ms tween)</li>
    </ul>

    <h2>3. 현재 이슈: 애니메이션이 재생되지 않음</h2>
    <div class="issue-box">
        <h3>증상</h3>
        <ul>
            <li>화면에 처음 진입할 때 아크가 <strong>0%→목표%로 채워지는 애니메이션이 일어나지 않음</strong></li>
            <li>게이지가 처음부터 최종 점수 위치에 고정된 상태로 표시됨</li>
        </ul>
        <h3>가정되는 원인</h3>
        <ul>
            <li><code>animateFloatAsState(targetValue = targetProgress)</code>는 <strong>targetValue가 변경될 때만</strong> 애니메이션을 시작함</li>
            <li>화면 첫 composition 시점에 이미 <code>displayScore</code>가 최종값(예: 430)으로 전달되므로, <code>targetProgress</code>도 처음부터 최종값(예: 0.72)</li>
            <li>Compose의 <code>animateFloatAsState</code>는 초기값을 지정하지 않으면 target과 동일하게 시작할 수 있어, "변화"가 없음 → 애니메이션 미발생</li>
        </ul>
        <h3>호출 흐름</h3>
        <ul>
            <li>Debug 메뉴 → "자가테스트 결과 ST-10" 클릭 → <code>SelfTestResultScreenST10(rawScore=23, ...)</code></li>
            <li><code>rawScoreToDisplayScore(23)</code> → 약 430점 → <code>targetProgress = (430-250)/250 ≈ 0.72</code></li>
            <li><code>ST10SemiCircleGauge(displayScore = 430)</code> 한 번만 composition, 이후 displayScore 변경 없음</li>
        </ul>
    </div>

    <h2>4. 기타 잠재 이슈</h2>
    <table>
        <thead>
            <tr><th>항목</th><th>내용</th></tr>
        </thead>
        <tbody>
            <tr>
                <td>그라데이션 순서</td>
                <td>Figma: 초록→파랑→노랑→주황/빨강. 현재: red→green→blue→yellow→orange→red (sweepGradient 배치가 다를 수 있음)</td>
            </tr>
            <tr>
                <td>삼각형 인디케이터</td>
                <td>rotate pivot과 Path 좌표가 반원 아크 끝단을 정확히 가리키는지 검증 필요</td>
            </tr>
        </tbody>
    </table>

    <h2>5. 관련 코드 (ResultGaugeGraph.kt - ST10SemiCircleGauge)</h2>
    <div class="code">@Composable
fun ST10SemiCircleGauge(
    displayScore: Int,
    modifier: Modifier = Modifier,
) {
    val clampedScore = displayScore.coerceIn(250, 500)
    val targetProgress = (clampedScore - 250) / 250f
    val animatedProgress by animateFloatAsState(
        targetValue = targetProgress,
        animationSpec = tween(durationMillis = 600),
        label = "gaugeProgress",
    )

    Box(modifier = modifier.fillMaxWidth(), contentAlignment = Alignment.BottomCenter) {
        Canvas(modifier = Modifier.fillMaxWidth().aspectRatio(2f).padding(...)) {
            // 1. 배경 회색 트랙
            drawArc(...)
            // 2. 그라데이션 아크 (animatedProgress 사용)
            if (animatedProgress > 0.001f) {
                drawArc(..., sweepAngle = 180f * animatedProgress, ...)
            }
            // 3. 삼각형 인디케이터 (rotate)
            withTransform({ rotate(degrees = 180f * animatedProgress, pivot = arcCenter) }) {
                drawPath(path = path, color = ...)
            }
        }
        Column(...) { /* 점수, 라벨 */ }
    }
}</div>

    <h2>6. 요청할 솔루션</h2>
    <ul>
        <li><strong>핵심:</strong> 화면 첫 진입 시 아크가 0%에서 목표%로 <strong>600ms 정도 애니메이션</strong>되도록 수정 방법</li>
        <li><code>animateFloatAsState</code> 대안 (예: <code>Animatable</code> + <code>LaunchedEffect</code>, <code>initialValue</code> 활용 등) 제안</li>
        <li>가능하다면 수정된 Kotlin 코드 스니펫 제공</li>
    </ul>

    <h2>7. 전체 복사용 (Claude/Gemini 질문)</h2>
    <div class="code" id="fullContent">Android Compose(Kotlin)로 Figma ST-10 반원형 게이지를 구현했습니다. 문제는 화면 첫 진입 시 아크가 0%→목표%로 채워지는 애니메이션이 전혀 재생되지 않는다는 것입니다.

[현재 구현]
- ST10SemiCircleGauge(displayScore: Int) Composable
- targetProgress = (displayScore - 250) / 250f (0~1)
- animateFloatAsState(targetValue = targetProgress, animationSpec = tween(600)) 사용
- 아크 sweepAngle = 180f * animatedProgress
- 삼각형 인디케이터도 animatedProgress로 rotate

[원인 가설]
- animateFloatAsState는 targetValue가 변경될 때만 애니메이션함
- 화면 진입 시 displayScore가 이미 최종값(예:430)으로 전달되어, 첫 composition 때 targetProgress=0.72로 고정
- "변화"가 없어 애니메이션이 시작되지 않음

[요청]
1. 화면 첫 진입 시 0 → targetProgress 로 600ms 애니메이션이 되도록 해결 방법
2. animateFloatAsState 대안 (Animatable, LaunchedEffect 등) 또는 올바른 사용법
3. 수정된 Kotlin 코드 스니펫

[코드 위치] app/src/main/java/com/cole/app/ResultGaugeGraph.kt 의 ST10SemiCircleGauge 함수</div>

    <button class="copy-btn" onclick="copyContent()">전체 내용 복사 (Claude/Gemini에 붙여넣기)</button>

    <script>
        function copyContent() {
            const text = document.getElementById('fullContent').innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert('복사되었습니다. Claude 또는 Gemini에 붙여넣기 하세요.');
            }).catch(err => {
                prompt('아래 내용을 수동으로 복사하세요:', text);
            });
        }
    </script>
</body>
</html>
